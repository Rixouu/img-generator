(()=>{var e={};e.id=362,e.ids=[362],e.modules={2006:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=2006,e.exports=t},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5291:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>w,requestAsyncStorage:()=>h,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>p});var n={};r.r(n),r.d(n,{POST:()=>u});var i=r(9303),s=r(8716),a=r(670),o=r(7070),c=r(9185),l=r.n(c);async function u(e){try{let{prompt:t}=await e.json();if(console.log("Received prompt:",t),!process.env.REPLICATE_API_TOKEN)return o.NextResponse.json({error:"REPLICATE_API_TOKEN is not set"},{status:500});let r=new(l())({auth:process.env.REPLICATE_API_TOKEN}),n=await r.run("stability-ai/sdxl:39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b",{input:{prompt:t}});if(!n||0===n.length)return o.NextResponse.json({error:"No output from Replicate"},{status:500});return o.NextResponse.json({imageUrl:n[0]})}catch(e){if(console.error("Error in image generation:",e),e instanceof Error)return o.NextResponse.json({error:"Failed to generate image",details:e.message},{status:500});return o.NextResponse.json({error:"Failed to generate image",details:"Unknown error"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/generate/replicate/route",pathname:"/api/generate/replicate",filename:"route",bundlePath:"app/api/generate/replicate/route"},resolvedPagePath:"/Users/cto/Documents/Repositories/01-Random/flux-app/app/api/generate/replicate/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:h,staticGenerationAsyncStorage:p,serverHooks:f}=d,m="/api/generate/replicate/route";function w(){return(0,a.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:p})}},9185:(e,t,r)=>{let n=r(6096),i=r(5305),{createReadableStream:s}=r(8995),{withAutomaticRetries:a,validateWebhook:o,parseProgressFromLogs:c,streamAsyncIterator:l}=r(7895),u=r(2193),d=r(6693),h=r(2441),p=r(5233),f=r(9046),m=r(8212),w=r(6915),y=r(9019),b=r(7930),g=r(9637);class v{constructor(e={}){this.auth=e.auth||("undefined"!=typeof process?process.env.REPLICATE_API_TOKEN:null),this.userAgent=e.userAgent||`replicate-javascript/${g.version}`,this.baseUrl=e.baseUrl||"https://api.replicate.com/v1",this.fetch=e.fetch||globalThis.fetch,this.fileEncodingStrategy=e.fileEncodingStrategy??"default",this.accounts={current:u.current.bind(this)},this.collections={list:d.list.bind(this),get:d.get.bind(this)},this.deployments={get:h.get.bind(this),create:h.create.bind(this),update:h.update.bind(this),delete:h.delete.bind(this),list:h.list.bind(this),predictions:{create:h.predictions.create.bind(this)}},this.files={create:p.create.bind(this),get:p.get.bind(this),list:p.list.bind(this),delete:p.delete.bind(this)},this.hardware={list:f.list.bind(this)},this.models={get:m.get.bind(this),list:m.list.bind(this),create:m.create.bind(this),versions:{list:m.versions.list.bind(this),get:m.versions.get.bind(this)},search:m.search.bind(this)},this.predictions={create:w.create.bind(this),get:w.get.bind(this),cancel:w.cancel.bind(this),list:w.list.bind(this)},this.trainings={create:y.create.bind(this),get:y.get.bind(this),cancel:y.cancel.bind(this),list:y.list.bind(this)},this.webhooks={default:{secret:{get:b.default.secret.get.bind(this)}}}}async run(e,t,r){let n;let{wait:s,signal:a,...o}=t,c=i.parse(e);if(c.version)n=await this.predictions.create({...o,version:c.version});else if(c.owner&&c.name)n=await this.predictions.create({...o,model:`${c.owner}/${c.name}`});else throw Error("Invalid model version identifier");if(r&&r(n),n=await this.wait(n,s||{},async e=>(r&&r(e),!!a&&!!a.aborted)),a&&a.aborted&&(n=await this.predictions.cancel(n.id)),r&&r(n),"failed"===n.status)throw Error(`Prediction failed: ${n.error}`);return n.output}async request(e,t){let r,i;let{auth:s,baseUrl:o,userAgent:c}=this;e instanceof URL?r=e:r=new URL(e.startsWith("/")?e.slice(1):e,o.endsWith("/")?o:`${o}/`);let{method:l="GET",params:u={},data:d}=t;for(let[e,t]of Object.entries(u))r.searchParams.append(e,t);let h={"Content-Type":"application/json","User-Agent":c};if(s&&(h.Authorization=`Bearer ${s}`),t.headers)for(let[e,r]of Object.entries(t.headers))h[e]=r;d instanceof FormData?(i=d,delete h["Content-Type"]):d&&(i=JSON.stringify(d));let p={method:l,headers:h,body:i},f=this.fetch,m=await a(async()=>f(r,p),{shouldRetry:"GET"===l?e=>429===e.status||e.status>=500:e=>429===e.status});if(!m.ok){let e=new Request(r,p),t=await m.text();throw new n(`Request to ${r} failed with status ${m.status} ${m.statusText}: ${t}.`,e,m)}return m}async *stream(e,t){let r;let{wait:n,signal:a,...o}=t,c=i.parse(e);if(c.version)r=await this.predictions.create({...o,version:c.version,stream:!0});else if(c.owner&&c.name)r=await this.predictions.create({...o,model:`${c.owner}/${c.name}`,stream:!0});else throw Error("Invalid model version identifier");if(r.urls&&r.urls.stream){let e=s({url:r.urls.stream,fetch:this.fetch,...a?{options:{signal:a}}:{}});yield*l(e)}else throw Error("Prediction does not support streaming")}async *paginate(e){let t=await e();yield t.results,t.next&&(yield*this.paginate(()=>this.request(t.next,{method:"GET"}).then(e=>e.json())))}async wait(e,t,r){let{id:n}=e;if(!n)throw Error("Invalid prediction");if("succeeded"===e.status||"failed"===e.status||"canceled"===e.status)return e;let i=e=>new Promise(t=>setTimeout(t,e)),s=t&&t.interval||500,a=await this.predictions.get(n);for(;"succeeded"!==a.status&&"failed"!==a.status&&"canceled"!==a.status&&(!r||await r(a)!==!0);)await i(s),a=await this.predictions.get(e.id);if("failed"===a.status)throw Error(`Prediction failed: ${a.error}`);return a}}e.exports=v,e.exports.validateWebhook=o,e.exports.parseProgressFromLogs=c},2193:e=>{async function t(){return(await this.request("/account",{method:"GET"})).json()}e.exports={current:t}},6693:e=>{async function t(e){return(await this.request(`/collections/${e}`,{method:"GET"})).json()}async function r(){return(await this.request("/collections",{method:"GET"})).json()}e.exports={get:t,list:r}},2441:(e,t,r)=>{let{transformFileInputs:n}=r(7895);async function i(e,t,r){let{stream:i,input:s,...a}=r;if(a.webhook)try{new URL(a.webhook)}catch(e){throw Error("Invalid webhook URL")}return(await this.request(`/deployments/${e}/${t}/predictions`,{method:"POST",data:{...a,input:await n(this,s,this.fileEncodingStrategy),stream:i}})).json()}async function s(e,t){return(await this.request(`/deployments/${e}/${t}`,{method:"GET"})).json()}async function a(e){return(await this.request("/deployments",{method:"POST",data:e})).json()}async function o(e,t,r){return(await this.request(`/deployments/${e}/${t}`,{method:"PATCH",data:r})).json()}async function c(e,t){return 204===(await this.request(`/deployments/${e}/${t}`,{method:"DELETE"})).status}async function l(){return(await this.request("/deployments",{method:"GET"})).json()}e.exports={predictions:{create:i},get:s,create:a,update:o,list:l,delete:c}},6096:e=>{class t extends Error{constructor(e,t,r){super(e),this.name="ApiError",this.request=t,this.response=r}}e.exports=t},5233:e=>{async function t(e,t={}){let r,n;let i=new FormData;if(e instanceof Blob)r=e.name||`blob_${Date.now()}`,n=e;else if(Buffer.isBuffer(e))r=`buffer_${Date.now()}`,n=new Blob([new Uint8Array(e)],{type:"application/octet-stream",name:r});else throw Error("Invalid file argument, must be a Blob, File or Buffer");return i.append("content",n,r),i.append("metadata",new Blob([JSON.stringify(t)],{type:"application/json"})),(await this.request("/files",{method:"POST",data:i,headers:{"Content-Type":"multipart/form-data"}})).json()}async function r(){return(await this.request("/files",{method:"GET"})).json()}async function n(e){return(await this.request(`/files/${e}`,{method:"GET"})).json()}async function i(e){return 204===(await this.request(`/files/${e}`,{method:"DELETE"})).status}e.exports={create:t,list:r,get:n,delete:i}},9046:e=>{async function t(){return(await this.request("/hardware",{method:"GET"})).json()}e.exports={list:t}},5305:e=>{class t{constructor(e,t,r=null){this.owner=e,this.name=t,this.version=r}static parse(e){let r=e.match(/^(?<owner>[^/]+)\/(?<name>[^/:]+)(:(?<version>.+))?$/);if(!r)throw Error(`Invalid reference to model version: ${e}. Expected format: owner/name or owner/name:version`);let{owner:n,name:i,version:s}=r.groups;return new t(n,i,s)}}e.exports=t},8212:e=>{async function t(e,t){return(await this.request(`/models/${e}/${t}`,{method:"GET"})).json()}async function r(e,t){return(await this.request(`/models/${e}/${t}/versions`,{method:"GET"})).json()}async function n(e,t,r){return(await this.request(`/models/${e}/${t}/versions/${r}`,{method:"GET"})).json()}async function i(){return(await this.request("/models",{method:"GET"})).json()}async function s(e,t,r){let n={owner:e,name:t,...r};return(await this.request("/models",{method:"POST",data:n})).json()}async function a(e){return(await this.request("/models",{method:"QUERY",headers:{"Content-Type":"text/plain"},data:e})).json()}e.exports={get:t,list:i,create:s,versions:{list:r,get:n},search:a}},6915:(e,t,r)=>{let{transformFileInputs:n}=r(7895);async function i(e){let t;let{model:r,version:i,stream:s,input:a,...o}=e;if(o.webhook)try{new URL(o.webhook)}catch(e){throw Error("Invalid webhook URL")}if(i)t=await this.request("/predictions",{method:"POST",data:{...o,input:await n(this,a,this.fileEncodingStrategy),version:i,stream:s}});else if(r)t=await this.request(`/models/${r}/predictions`,{method:"POST",data:{...o,input:await n(this,a,this.fileEncodingStrategy),stream:s}});else throw Error("Either model or version must be specified");return t.json()}async function s(e){return(await this.request(`/predictions/${e}`,{method:"GET"})).json()}async function a(e){return(await this.request(`/predictions/${e}/cancel`,{method:"POST"})).json()}async function o(){return(await this.request("/predictions",{method:"GET"})).json()}e.exports={create:i,get:s,cancel:a,list:o}},8995:(e,t,r)=>{let n=r(6096),{streamAsyncIterator:i}=r(7895),{EventSourceParserStream:s}=r(3745),{TextDecoderStream:a}=void 0===globalThis.TextDecoderStream?r(7601):globalThis;class o{constructor(e,t,r,n){this.event=e,this.data=t,this.id=r,this.retry=n}toString(){return"output"===this.event?this.data:""}}e.exports={createReadableStream:function({url:e,fetch:t,options:r={}}){return new ReadableStream({async start(c){let l={...r,headers:{...r.headers,Accept:"text/event-stream"}},u=await t(e,l);if(!u.ok){let t=await u.text(),r=new Request(e,l);c.error(new n(`Request to ${e} failed with status ${u.status}: ${t}`,r,u))}for await(let e of i(u.body.pipeThrough(new a).pipeThrough(new s))){if("error"===e.event){c.error(Error(e.data));break}if(c.enqueue(new o(e.event,e.data,e.id)),"done"===e.event)break}c.close()}})},ServerSentEvent:o}},9019:e=>{async function t(e,t,r,n){let{...i}=n;if(i.webhook)try{new URL(i.webhook)}catch(e){throw Error("Invalid webhook URL")}return(await this.request(`/models/${e}/${t}/versions/${r}/trainings`,{method:"POST",data:i})).json()}async function r(e){return(await this.request(`/trainings/${e}`,{method:"GET"})).json()}async function n(e){return(await this.request(`/trainings/${e}/cancel`,{method:"POST"})).json()}async function i(){return(await this.request("/trainings",{method:"GET"})).json()}e.exports={create:t,get:r,cancel:n,list:i}},7895:(e,t,r)=>{let n=r(6096),{create:i}=r(5233);async function s(e,t){let{id:r,timestamp:n,body:i,signature:s}=e,o=t||e.secret;if(e&&e.headers&&e.body&&("function"==typeof e.headers.get?(r=e.headers.get("webhook-id"),n=e.headers.get("webhook-timestamp"),s=e.headers.get("webhook-signature")):(r=e.headers["webhook-id"],n=e.headers["webhook-timestamp"],s=e.headers["webhook-signature"]),i=e.body),i instanceof ReadableStream||i.readable)try{i=await new Response(i).text()}catch(e){throw Error(`Error reading body: ${e.message}`)}else if(p(i))i=await new Blob([i]).text();else if("object"==typeof i)i=JSON.stringify(i);else if("string"!=typeof i)throw Error("Invalid body type");if(!r||!n||!s)throw Error("Missing required webhook headers");if(!i)throw Error("Missing required body");if(!o)throw Error("Missing required secret");let c=`${r}.${n}.${i}`,l=await a(o.split("_").pop(),c);return s.split(" ").map(e=>e.split(",")[1]).some(e=>e===l)}async function a(e,t){let n=new TextEncoder,i=globalThis.crypto;void 0===i&&(i=r(2006).call(null,"node:crypto").webcrypto);let s=await i.subtle.importKey("raw",Uint8Array.from(atob(e),e=>e.codePointAt(0)),{name:"HMAC",hash:"SHA-256"},!1,["sign"]);return o(await i.subtle.sign("HMAC",s,n.encode(t)))}function o(e){return btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}async function c(e,t={}){let r=t.shouldRetry||(()=>!1),i=t.maxRetries||5,s=t.interval||500,a=t.jitter||100,o=e=>new Promise(t=>setTimeout(t,e)),c=0;do{let l=s*2**c+Math.random()*a;try{let t=await e();if(t.ok||!r(t))return t}catch(e){if(e instanceof n){let t=e.response.headers.get("Retry-After");if(t){if(Number.isInteger(t))l=1e3*t;else{let e=new Date(t);Number.isNaN(e.getTime())||(l=e.getTime()-new Date().getTime())}}}}Number.isInteger(i)&&i>0&&(Number.isInteger(l)&&l>0&&await o(s*2**(t.maxRetries-i)),c+=1)}while(c<i);return e()}async function l(e,t,r){switch(r){case"data-uri":return await d(e,t);case"upload":return await u(e,t);case"default":try{return await u(e,t)}catch(e){if(e instanceof n&&e.response.status>=400&&e.response.status<500)throw e;return await d(t)}default:throw Error(`Unexpected file upload strategy: ${r}`)}}async function u(e,t){return await h(t,async t=>t instanceof Blob||t instanceof Buffer?(await i.call(e,t)).urls.get:t)}async function d(e){let t=0;return await h(e,async e=>{let r,n;if(e instanceof Blob)r=await e.arrayBuffer(),n=e.type;else{if(!p(e))return e;r=e}if((t+=r.byteLength)>1e7)throw Error(`Combined filesize of prediction ${t} bytes exceeds 10mb limit for inline encoding, please provide URLs instead`);let i=o(r);return n=n??"application/octet-stream",`data:${n};base64,${i}`})}async function h(e,t){if(Array.isArray(e)){let r=[];for(let n of e){let e=await h(n,t);r.push(e)}return r}if(function(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==String(e))return!1;let t=Object.getPrototypeOf(e);if(null===t)return!0;let r=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&Function.prototype.toString.call(r)===Function.prototype.toString.call(Object)}(e)){let r={};for(let n of Object.keys(e))r[n]=await h(e[n],t);return r}return await t(e)}function p(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}async function*f(e){let t=e.getReader();try{for(;;){let{done:e,value:r}=await t.read();if(e)return;yield r}}finally{t.releaseLock()}}e.exports={transformFileInputs:l,validateWebhook:s,withAutomaticRetries:c,parseProgressFromLogs:function(e){let t="object"==typeof e&&e.logs?e.logs:e;if(!t||"string"!=typeof t)return null;let r=/^\s*(\d+)%\s*\|.+?\|\s*(\d+)\/(\d+)/;for(let e of t.split("\n").reverse()){let t=e.match(r);if(t&&4===t.length)return{percentage:parseInt(t[1],10)/100,current:parseInt(t[2],10),total:parseInt(t[3],10)}}return null},streamAsyncIterator:f}},7930:e=>{async function t(){return(await this.request("/webhooks/default/secret",{method:"GET"})).json()}e.exports={default:{secret:{get:t}}}},3745:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(s,{EventSourceParserStream:()=>o}),e.exports=((e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of n(s))i.call(e,a)||void 0===a||t(e,a,{get:()=>s[a],enumerable:!(o=r(s,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),s);var a=[239,187,191],o=class extends TransformStream{constructor(){let e;super({start(t){e=function(e){let t,r,n,i,s,o,c;return l(),{feed:function(l){var u;r=r?r+l:l,t&&(u=r,a.every((e,t)=>u.charCodeAt(t)===e))&&(r=r.slice(a.length)),t=!1;let d=r.length,h=0,p=!1;for(;h<d;){let t;p&&("\n"===r[h]&&++h,p=!1);let a=-1,l=i;for(let e=n;a<0&&e<d;++e)":"===(t=r[e])&&l<0?l=e-h:"\r"===t?(p=!0,a=e-h):"\n"===t&&(a=e-h);if(a<0){n=d-h,i=l;break}n=0,i=-1,function(t,r,n,i){if(0===i){c.length>0&&(e({type:"event",id:s,event:o||void 0,data:c.slice(0,-1)}),c="",s=void 0),o=void 0;return}let a=n<0,l=t.slice(r,r+(a?i:n)),u=0;u=a?i:" "===t[r+n+1]?n+2:n+1;let d=r+u,h=i-u,p=t.slice(d,d+h).toString();if("data"===l)c+=p?"".concat(p,"\n"):"\n";else if("event"===l)o=p;else if("id"!==l||p.includes("\0")){if("retry"===l){let t=parseInt(p,10);Number.isNaN(t)||e({type:"reconnect-interval",value:t})}}else s=p}(r,h,l,a),h+=a+1}h===d?r="":h>0&&(r=r.slice(h))},reset:l};function l(){t=!0,r="",n=0,i=-1,s=void 0,o=void 0,c=""}}(e=>{"event"===e.type&&t.enqueue(e)})},transform(t){e.feed(t)}})}}},7601:e=>{var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(s,{TextDecoderStream:()=>l}),e.exports=((e,s,a,o)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let a of n(s))i.call(e,a)||void 0===a||t(e,a,{get:()=>s[a],enumerable:!(o=r(s,a))||o.enumerable});return e})(t({},"__esModule",{value:!0}),s);var a=Symbol("decDecoder"),o=Symbol("decTransform"),c=class{constructor(e){this.decoder_=e}transform(e,t){if(!(e instanceof ArrayBuffer||ArrayBuffer.isView(e)))throw TypeError("Input data must be a BufferSource");let r=this.decoder_.decode(e,{stream:!0});0!==r.length&&t.enqueue(r)}flush(e){let t=this.decoder_.decode();0!==t.length&&e.enqueue(t)}},l=class{constructor(e,t){let r=new TextDecoder(e||"utf-8",t||{});this[a]=r,this[o]=new TransformStream(new c(r))}get encoding(){return this[a].encoding}get fatal(){return this[a].fatal}get ignoreBOM(){return this[a].ignoreBOM}get readable(){return this[o].readable}get writable(){return this[o].writable}};Symbol("encEncoder"),Symbol("encTransform")},9637:e=>{"use strict";e.exports=JSON.parse('{"name":"replicate","version":"0.32.1","description":"JavaScript client for Replicate","repository":"github:replicate/replicate-javascript","homepage":"https://github.com/replicate/replicate-javascript#readme","bugs":"https://github.com/replicate/replicate-javascript/issues","license":"Apache-2.0","main":"index.js","type":"commonjs","types":"index.d.ts","files":["CONTRIBUTING.md","LICENSE","README.md","index.d.ts","index.js","lib/**/*.js","vendor/**/*","package.json"],"engines":{"node":">=18.0.0","npm":">=7.19.0","git":">=2.11.0","yarn":">=1.7.0"},"scripts":{"check":"tsc","format":"biome format . --write","lint-biome":"biome lint .","lint-publint":"publint","lint":"npm run lint-biome && npm run lint-publint","test":"jest"},"optionalDependencies":{"readable-stream":">=4.0.0"},"devDependencies":{"@biomejs/biome":"^1.4.1","@types/jest":"^29.5.3","@typescript-eslint/eslint-plugin":"^5.56.0","cross-fetch":"^3.1.5","jest":"^29.7.0","nock":"^14.0.0-beta.6","publint":"^0.2.7","ts-jest":"^29.1.0","typescript":"^5.0.2"}}')}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(5291));module.exports=n})();