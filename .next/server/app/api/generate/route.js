"use strict";(()=>{var e={};e.id=290,e.ids=[290],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3166:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>eo,patchFetch:()=>es,requestAsyncStorage:()=>en,routeModule:()=>er,serverHooks:()=>ei,staticGenerationAsyncStorage:()=>ea});var n={};r.r(n),r.d(n,{POST:()=>et});var a=r(9303),i=r(8716),o=r(670),s=r(7070),c=Object.defineProperty,u={};function l(e){return/^http(s?):/.test(e)||e.startsWith("/")}((e,t)=>{for(var r in t)c(e,r,{get:t[r],enumerable:!0})})(u,{audioClassification:()=>x,audioToAudio:()=>E,automaticSpeechRecognition:()=>k,chatCompletion:()=>X,chatCompletionStream:()=>G,documentQuestionAnswering:()=>Q,featureExtraction:()=>O,fillMask:()=>$,imageClassification:()=>H,imageSegmentation:()=>j,imageToImage:()=>S,imageToText:()=>T,objectDetection:()=>_,questionAnswering:()=>R,request:()=>w,sentenceSimilarity:()=>U,streamingRequest:()=>h,summarization:()=>P,tableQuestionAnswering:()=>z,tabularClassification:()=>Y,tabularRegression:()=>K,textClassification:()=>I,textGeneration:()=>D,textGenerationStream:()=>F,textToImage:()=>C,textToSpeech:()=>v,tokenClassification:()=>W,translation:()=>M,visualQuestionAnswering:()=>J,zeroShotClassification:()=>L,zeroShotImageClassification:()=>q});var f=new Map,y="https://huggingface.co";async function p(e,t,r){if(l(e))return null;let n=`${e}:${t}`,a=f.get(n);if(a&&a.date<new Date(Date.now()-6e5)&&(f.delete(n),a=void 0),void 0===a){let i=await (r?.fetch??fetch)(`${y}/api/models/${e}?expand[]=pipeline_tag`,{headers:t?{Authorization:`Bearer ${t}`}:{}}).then(e=>e.json()).then(e=>e.pipeline_tag).catch(()=>null);if(!i)return null;a={task:i,date:new Date},f.set(n,{task:i,date:new Date}),f.size>1e3&&f.delete(f.keys().next().value)}return a.task}var m="https://api-inference.huggingface.co",d=null;async function g(e,t){let r;let{accessToken:n,endpointUrl:a,...i}=e,{model:o}=e,{forceTask:s,includeCredentials:c,taskHint:u,wait_for_model:f,use_cache:p,dont_load_model:g,chatCompletion:w}=t??{},b={};if(n&&(b.Authorization=`Bearer ${n}`),!o&&!d&&u){let e=await fetch(`${y}/api/tasks`);e.ok&&(d=await e.json())}if(!o&&d&&u){let e=d[u];e&&(o=e.models[0].id)}if(!o)throw Error("No model provided, and no default model found for this task");let h="data"in e&&!!e.data;h||(b["Content-Type"]="application/json"),f&&(b["X-Wait-For-Model"]="true"),!1===p&&(b["X-Use-Cache"]="false"),g&&(b["X-Load-Model"]="0");let A=(()=>{if(a&&l(o))throw TypeError("Both model and endpointUrl cannot be URLs");return l(o)?(console.warn("Using a model URL is deprecated, please use the `endpointUrl` parameter instead"),o):a||(s?`${m}/pipeline/${s}/${o}`:`${m}/models/${o}`)})();return w&&!A.endsWith("/chat/completions")&&(A+="/v1/chat/completions"),"string"==typeof c?r=c:!0===c&&(r="include"),{url:A,info:{headers:b,method:"POST",body:h?e.data:JSON.stringify({...i.model&&l(i.model)?function(e,t){let r=Array.isArray(t)?t:[t];return Object.assign({},...Object.keys(e).filter(e=>!r.includes(e)).map(t=>{if(void 0!==e[t])return{[t]:e[t]}}))}(i,"model"):i}),...r&&{credentials:r},signal:t?.signal}}}async function w(e,t){let{url:r,info:n}=await g(e,t),a=await (t?.fetch??fetch)(r,n);if(t?.retry_on_error!==!1&&503===a.status&&!t?.wait_for_model)return w(e,{...t,wait_for_model:!0});if(!a.ok){if(a.headers.get("Content-Type")?.startsWith("application/json")){let r=await a.json();if([400,422,404,500].includes(a.status)&&t?.chatCompletion)throw Error(`Server ${e.model} does not seem to support chat completion. Error: ${r.error}`);if(r.error)throw Error(r.error)}throw Error("An error occurred while fetching the blob")}return a.headers.get("Content-Type")?.startsWith("application/json")?await a.json():await a.blob()}function b(){return{data:"",event:"",id:"",retry:void 0}}async function*h(e,t){var r;let n,a,i,o;let{url:s,info:c}=await g({...e,stream:!0},t),u=await (t?.fetch??fetch)(s,c);if(t?.retry_on_error!==!1&&503===u.status&&!t?.wait_for_model)return yield*h(e,{...t,wait_for_model:!0});if(!u.ok){if(u.headers.get("Content-Type")?.startsWith("application/json")){let r=await u.json();if([400,422,404,500].includes(u.status)&&t?.chatCompletion)throw Error(`Server ${e.model} does not seem to support chat completion. Error: ${r.error}`);if(r.error)throw Error(r.error)}throw Error(`Server response contains error: ${u.status}`)}if(!u.headers.get("content-type")?.startsWith("text/event-stream"))throw Error("Server does not support event stream content type, it returned "+u.headers.get("content-type"));if(!u.body)return;let l=u.body.getReader(),f=[],y=(r=function(e,t,r){let n=b(),a=new TextDecoder;return function(i,o){if(0===i.length)r?.(n),n=b();else if(o>0){let r=a.decode(i.subarray(0,o)),s=o+(32===i[o+1]?2:1),c=a.decode(i.subarray(s));switch(r){case"data":n.data=n.data?n.data+"\n"+c:c;break;case"event":n.event=c;break;case"id":e(n.id=c);break;case"retry":let u=parseInt(c,10);isNaN(u)||t(n.retry=u)}}}}(()=>{},()=>{},e=>{f.push(e)}),o=!1,function(e){void 0===n?(n=e,a=0,i=-1):n=function(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}(n,e);let t=n.length,s=0;for(;a<t;){o&&(10===n[a]&&(s=++a),o=!1);let e=-1;for(;a<t&&-1===e;++a)switch(n[a]){case 58:-1===i&&(i=a-s);break;case 13:o=!0;case 10:e=a}if(-1===e)break;r(n.subarray(s,e),i),s=a,i=-1}s===t?n=void 0:0!==s&&(n=n.subarray(s),a-=s)});try{for(;;){let{done:e,value:t}=await l.read();if(e)return;for(let e of(y(t),f))if(e.data.length>0){if("[DONE]"===e.data)return;let t=JSON.parse(e.data);if("object"==typeof t&&null!==t&&"error"in t)throw Error(t.error);yield t}f=[]}}finally{l.releaseLock()}}var A=class extends TypeError{constructor(e){super(`Invalid inference output: ${e}. Use the 'request' method with the same parameters to do a custom call with no type checking.`),this.name="InferenceOutputError"}};async function x(e,t){let r=await w(e,{...t,taskHint:"audio-classification"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new A("Expected Array<{label: string, score: number}>");return r}async function k(e,t){let r=await w(e,{...t,taskHint:"automatic-speech-recognition"});if("string"!=typeof r?.text)throw new A("Expected {text: string}");return r}async function v(e,t){let r=await w(e,{...t,taskHint:"text-to-speech"});if(!(r&&r instanceof Blob))throw new A("Expected Blob");return r}async function E(e,t){let r=await w(e,{...t,taskHint:"audio-to-audio"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"string"==typeof e.blob&&"string"==typeof e["content-type"])))throw new A("Expected Array<{label: string, blob: string, content-type: string}>");return r}async function H(e,t){let r=await w(e,{...t,taskHint:"image-classification"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new A("Expected Array<{label: string, score: number}>");return r}async function j(e,t){let r=await w(e,{...t,taskHint:"image-segmentation"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"string"==typeof e.mask&&"number"==typeof e.score)))throw new A("Expected Array<{label: string, mask: string, score: number}>");return r}async function T(e,t){let r=(await w(e,{...t,taskHint:"image-to-text"}))?.[0];if("string"!=typeof r?.generated_text)throw new A("Expected {generated_text: string}");return r}async function _(e,t){let r=await w(e,{...t,taskHint:"object-detection"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e.label&&"number"==typeof e.score&&"number"==typeof e.box.xmin&&"number"==typeof e.box.ymin&&"number"==typeof e.box.xmax&&"number"==typeof e.box.ymax)))throw new A("Expected Array<{label:string; score:number; box:{xmin:number; ymin:number; xmax:number; ymax:number}}>");return r}async function C(e,t){let r=await w(e,{...t,taskHint:"text-to-image"});if(!(r&&r instanceof Blob))throw new A("Expected Blob");return r}function B(e){if(globalThis.Buffer)return globalThis.Buffer.from(e).toString("base64");{let t=[];return e.forEach(e=>{t.push(String.fromCharCode(e))}),globalThis.btoa(t.join(""))}}async function S(e,t){let r;r=e.parameters?{...e,inputs:B(new Uint8Array(e.inputs instanceof ArrayBuffer?e.inputs:await e.inputs.arrayBuffer()))}:{accessToken:e.accessToken,model:e.model,data:e.inputs};let n=await w(r,{...t,taskHint:"image-to-image"});if(!(n&&n instanceof Blob))throw new A("Expected Blob");return n}async function q(e,t){let r={...e,inputs:{image:B(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=await w(r,{...t,taskHint:"zero-shot-image-classification"});if(!(Array.isArray(n)&&n.every(e=>"string"==typeof e.label&&"number"==typeof e.score)))throw new A("Expected Array<{label: string, score: number}>");return n}async function O(e,t){let r=e.model?await p(e.model,e.accessToken,t):void 0,n=await w(e,{...t,taskHint:"feature-extraction",..."sentence-similarity"===r&&{forceTask:"feature-extraction"}}),a=(e,t,r=0)=>!(r>t)&&(e.every(e=>Array.isArray(e))?e.every(e=>a(e,t,r+1)):e.every(e=>"number"==typeof e));if(!(Array.isArray(n)&&a(n,3,0)))throw new A("Expected Array<number[][][] | number[][] | number[] | number>");return n}async function $(e,t){let r=await w(e,{...t,taskHint:"fill-mask"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e.score&&"string"==typeof e.sequence&&"number"==typeof e.token&&"string"==typeof e.token_str)))throw new A("Expected Array<{score: number, sequence: string, token: number, token_str: string}>");return r}async function R(e,t){let r=await w(e,{...t,taskHint:"question-answering"});if(!("object"==typeof r&&r&&"string"==typeof r.answer&&"number"==typeof r.end&&"number"==typeof r.score&&"number"==typeof r.start))throw new A("Expected {answer: string, end: number, score: number, start: number}");return r}async function U(e,t){let r=e.model?await p(e.model,e.accessToken,t):void 0,n=await w(e,{...t,taskHint:"sentence-similarity",..."feature-extraction"===r&&{forceTask:"sentence-similarity"}});if(!(Array.isArray(n)&&n.every(e=>"number"==typeof e)))throw new A("Expected number[]");return n}async function P(e,t){let r=await w(e,{...t,taskHint:"summarization"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.summary_text)))throw new A("Expected Array<{summary_text: string}>");return r?.[0]}async function z(e,t){let r=await w(e,{...t,taskHint:"table-question-answering"});if(!("string"==typeof r?.aggregator&&"string"==typeof r.answer&&Array.isArray(r.cells)&&r.cells.every(e=>"string"==typeof e)&&Array.isArray(r.coordinates)&&r.coordinates.every(e=>Array.isArray(e)&&e.every(e=>"number"==typeof e))))throw new A("Expected {aggregator: string, answer: string, cells: string[], coordinates: number[][]}");return r}async function I(e,t){let r=(await w(e,{...t,taskHint:"text-classification"}))?.[0];if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.label&&"number"==typeof e.score)))throw new A("Expected Array<{label: string, score: number}>");return r}function N(e){return Array.isArray(e)?e:[e]}async function D(e,t){let r=N(await w(e,{...t,taskHint:"text-generation"}));if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.generated_text)))throw new A("Expected Array<{generated_text: string}>");return r?.[0]}async function*F(e,t){yield*h(e,{...t,taskHint:"text-generation"})}async function W(e,t){let r=N(await w(e,{...t,taskHint:"token-classification"}));if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e.end&&"string"==typeof e.entity_group&&"number"==typeof e.score&&"number"==typeof e.start&&"string"==typeof e.word)))throw new A("Expected Array<{end: number, entity_group: string, score: number, start: number, word: string}>");return r}async function M(e,t){let r=await w(e,{...t,taskHint:"translation"});if(!(Array.isArray(r)&&r.every(e=>"string"==typeof e?.translation_text)))throw new A("Expected type Array<{translation_text: string}>");return r?.length===1?r?.[0]:r}async function L(e,t){let r=N(await w(e,{...t,taskHint:"zero-shot-classification"}));if(!(Array.isArray(r)&&r.every(e=>Array.isArray(e.labels)&&e.labels.every(e=>"string"==typeof e)&&Array.isArray(e.scores)&&e.scores.every(e=>"number"==typeof e)&&"string"==typeof e.sequence)))throw new A("Expected Array<{labels: string[], scores: number[], sequence: string}>");return r}async function X(e,t){let r=await w(e,{...t,taskHint:"text-generation",chatCompletion:!0});if(!("object"==typeof r&&Array.isArray(r?.choices)&&"number"==typeof r?.created&&"string"==typeof r?.id&&"string"==typeof r?.model&&"string"==typeof r?.system_fingerprint&&"object"==typeof r?.usage))throw new A("Expected ChatCompletionOutput");return r}async function*G(e,t){yield*h(e,{...t,taskHint:"text-generation",chatCompletion:!0})}async function Q(e,t){let r={...e,inputs:{question:e.inputs.question,image:B(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=N(await w(r,{...t,taskHint:"document-question-answering"}))?.[0];if(!("string"==typeof n?.answer&&("number"==typeof n.end||void 0===n.end)&&("number"==typeof n.score||void 0===n.score)&&("number"==typeof n.start||void 0===n.start)))throw new A("Expected Array<{answer: string, end?: number, score?: number, start?: number}>");return n}async function J(e,t){let r={...e,inputs:{question:e.inputs.question,image:B(new Uint8Array(e.inputs.image instanceof ArrayBuffer?e.inputs.image:await e.inputs.image.arrayBuffer()))}},n=(await w(r,{...t,taskHint:"visual-question-answering"}))?.[0];if(!("string"==typeof n?.answer&&"number"==typeof n.score))throw new A("Expected Array<{answer: string, score: number}>");return n}async function K(e,t){let r=await w(e,{...t,taskHint:"tabular-regression"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e)))throw new A("Expected number[]");return r}async function Y(e,t){let r=await w(e,{...t,taskHint:"tabular-classification"});if(!(Array.isArray(r)&&r.every(e=>"number"==typeof e)))throw new A("Expected number[]");return r}var V=class{accessToken;defaultOptions;constructor(e="",t={}){for(let[r,n]of(this.accessToken=e,this.defaultOptions=t,Object.entries(u)))Object.defineProperty(this,r,{enumerable:!1,value:(r,a)=>n({...r,accessToken:e},{...t,...a})})}endpoint(e){return new Z(e,this.accessToken,this.defaultOptions)}},Z=class{constructor(e,t="",r={}){for(let[n,a]of Object.entries(u))Object.defineProperty(this,n,{enumerable:!1,value:(n,i)=>a({...n,accessToken:t,endpointUrl:e},{...r,...i})})}};let ee=process.env.HF_API_KEY;async function et(e){if(!ee)return s.NextResponse.json({error:"Hugging Face API key is not set"},{status:500});let t=new V(ee);try{let{prompt:r}=await e.json();console.log("Received prompt:",r);let n=await t.textToImage({model:"stabilityai/stable-diffusion-2-1",inputs:r,parameters:{}});if(!n)throw Error("Failed to generate image");let a=await n.arrayBuffer(),i=Buffer.from(a).toString("base64"),o=`data:image/png;base64,${i}`;return s.NextResponse.json({imageUrl:o})}catch(t){console.error("Error in image generation:",t);let e="Failed to generate image";return t instanceof Error&&(e=t.message),s.NextResponse.json({error:e},{status:500})}}let er=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/generate/route",pathname:"/api/generate",filename:"route",bundlePath:"app/api/generate/route"},resolvedPagePath:"/Users/cto/Documents/Repositories/01-Random/flux-app/app/api/generate/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:en,staticGenerationAsyncStorage:ea,serverHooks:ei}=er,eo="/api/generate/route";function es(){return(0,o.patchFetch)({serverHooks:ei,staticGenerationAsyncStorage:ea})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(3166));module.exports=n})();